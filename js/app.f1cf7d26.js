(function(t){function e(e){for(var o,a,i=e[0],c=e[1],u=e[2],p=0,m=[];p<i.length;p++)a=i[p],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&m.push(r[a][0]),r[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);l&&l(e);while(m.length)m.shift()();return n.push.apply(n,u||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],o=!0,i=1;i<s.length;i++){var c=s[i];0!==r[c]&&(o=!1)}o&&(n.splice(e--,1),t=a(a.s=s[0]))}return t}var o={},r={app:0},n=[];function a(e){if(o[e])return o[e].exports;var s=o[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=o,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(s,o,function(e){return t[e]}.bind(null,o));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/syncify/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=c;n.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var o=s("85ec"),r=s.n(o);r.a},1:function(t,e){},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),r=s("8c4f"),n=s("2f62");o["a"].use(n["a"]);var a=new n["a"].Store({state:{room:null,accessToken:""},mutations:{setRoom:function(t,e){return t.room=e},setAccessToken:function(t,e){return t.accessToken=e}}}),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[t.$store.state.accessToken?s("div",{staticClass:"fixed w-full h-full top-0 text-gray-700 overflow-auto bg-white"},[s("h1",{staticClass:"text-5xl font-bold mb-4 mt-16"},[t._v("Syncify")]),t.$store.state.room?s("Player"):s("RoomMenu")],1):t._e()])},c=[],u=(s("d3b7"),s("ac1f"),s("25f0"),s("3ca3"),s("5319"),s("1276"),s("ddb0"),s("2b3d"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"inline-block"},[s("button",{staticClass:"menu-btn menu-btn-green",class:{"menu-btn-active":"create"==t.mode,"menu-btn-green-active":"create"==t.mode},on:{click:function(e){t.mode="create",t.error=""}}},[t._v("Create a room")]),s("button",{staticClass:"menu-btn menu-btn-blue",class:{"menu-btn-active":"join"==t.mode,"menu-btn-blue-active":"join"==t.mode},on:{click:function(e){t.mode="join",t.error=""}}},[t._v("Join a room")])]),t.mode?s("div",[s("form",{},[s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.room,expression:"room"}],staticClass:"form",attrs:{type:"text",placeholder:"Room name",autocomplete:"off"},domProps:{value:t.room},on:{input:function(e){e.target.composing||(t.room=e.target.value)}}})]),s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form",attrs:{type:"password",placeholder:"Password",autocomplete:"off"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),s("p",{staticClass:"text-red-500 h-4 my-2"},[t._v(t._s(t.error))]),s("button",{staticClass:"menu-btn bg-purple-500 text-white disabled:opacity-50",attrs:{disabled:t.submitDisabled},on:{click:function(e){return e.preventDefault(),t.submit(e)}}},[t._v("Submit")])])]):t._e()])}),l=[],p=s("bc3a"),m={name:"RoomMenu",data:function(){return{mode:null,room:null,password:null,error:""}},computed:{submitDisabled:function(){return!(this.room&&this.password)}},methods:{submit:function(){var t=this;if(!this.submitDisabled){var e="https://syncify-server.herokuapp.com",s={room:this.room,password:this.password};if("create"===this.mode){var o=e+"/create";p.post(o,s).then((function(){t.$store.commit("setRoom",t.room)})).catch((function(e){409===e.response.status&&(t.error="Room name already exists")}))}else{var r=e+"/join";p.post(r,s).then((function(){t.$store.commit("setRoom",t.room)})).catch((function(e){401===e.response.status&&(t.error="Incorrect room name or password")}))}}}}},d=m,f=s("2877"),h=Object(f["a"])(d,u,l,!1,null,null,null),v=h.exports,y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[null!==t.error?s("p",{staticClass:"text-4xl w-6/12 m-auto"},[t._v(t._s(t.error))]):null!==t.state?s("div",[s("h2",{staticClass:"text-4xl my-12"},[t._v(t._s(t.track.name))]),s("h3",{staticClass:"text-2xl text-gray-500"},[t._v(t._s(t.track.artists.map((function(t){return t.name})).join(", ")))]),s("h3",{staticClass:"text-2xl mb-16 text-gray-500"},[t._v(t._s(t.track.album.name))]),s("div",{staticClass:"m-2"},[s("button",{staticClass:"media-btn",on:{click:t.previousTrack}},[s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"}},[s("path",{attrs:{d:"M12 12h4v24h-4zm7 12l17 12V12z"}})])]),t.state.paused?s("button",{staticClass:"media-btn",on:{click:t.resume}},[s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"}},[s("path",{attrs:{d:"M16 10v28l22-14z"}})])]):s("button",{staticClass:"media-btn",on:{click:t.pause}},[s("svg",{staticClass:"appearance-none",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"}},[s("path",{attrs:{d:"M12 38h8V10h-8v28zm16-28v28h8V10h-8z"}})])]),s("button",{staticClass:"media-btn",on:{click:t.nextTrack}},[s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"}},[s("path",{attrs:{d:"M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"}})])])]),s("div",{staticClass:"w-full pb-16"},[s("span",{staticClass:"mr-2"},[t._v(t._s(t.songProgress))]),s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.progress,expression:"progress",modifiers:{number:!0}}],staticClass:"slider",attrs:{type:"range",min:"0",max:t.track.duration_ms},domProps:{value:t.progress},on:{change:t.seek,__r:function(e){t.progress=t._n(e.target.value)},blur:function(e){return t.$forceUpdate()}}}),s("span",{staticClass:"ml-2"},[t._v(t._s(t.songLength))])]),s("div",{staticClass:"inline"},[s("p",{staticClass:"text-xl"},[t._v("Room: "+t._s(t.$store.state.room))]),s("button",{staticClass:"menu-btn menu-btn-red",on:{click:t.exit}},[t._v("Leave")])]),s("div",[s("h4",{staticClass:"text-xl mt-6"},[t._v("Users")]),t._l(t.users,(function(e){return s("p",{key:e,staticClass:"text-base m-2"},[t._v(t._s(e))])}))],2)]):t._e()])},b=[],g=s("bc3a"),k=s("8055"),w={name:"Player",data:function(){return{player:null,state:null,socket:null,users:[],progress:0,error:null}},methods:{resume:function(){this.player.resume(),this.socket.emit("resume")},pause:function(){this.player.pause(),this.socket.emit("pause")},previousTrack:function(){this.progress<25?this.player.previousTrack():(this.player.seek(0),this.socket.emit("seek",0)),this.progress=0,this.state.position=0,this.state.timestamp=Date.now()},nextTrack:function(){this.player.nextTrack(),this.progress=0,this.state.position=0,this.state.timestamp=Date.now()},seek:function(){this.player.seek(this.progress),this.socket.emit("seek",this.progress),this.state.position=this.progress,this.state.timestamp=Date.now()},exit:function(){this.$store.commit("setRoom",null),this.socket.close(),this.player.disconnect()},msToString:function(t){var e=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);return e.toString()+":"+(s<10?"0"+s:s)}},computed:{track:function(){return this.state.track_window.current_track},songLength:function(){return this.msToString(this.track.duration_ms)},songProgress:function(){return this.msToString(this.progress)}},created:function(){var t=this,e=this.$store.state.accessToken,s={headers:{Authorization:"Bearer "+e}},o="https://syncify-server.herokuapp.com";this.socket=k.connect(o),this.socket.on("connect",(function(){g.get("https://api.spotify.com/v1/me",s).then((function(e){t.socket.emit("info",[e.data.display_name,t.$store.state.room])})).catch((function(t){return console.error(t.response)}))})),this.socket.on("users",(function(e){t.users=e})),this.socket.on("pause",(function(){t.player.pause()})),this.socket.on("resume",(function(){t.player.resume()})),this.socket.on("seek",(function(e){t.progress=e,t.player.seek(e)})),this.socket.on("song",(function(e){if(t.track.uri!=e){t.progress=0;var o={uris:[e]};g.put("https://api.spotify.com/v1/me/player/play",o,s).catch((function(t){return console.error(t.response)}))}})),setInterval((function(){null!==t.state&&(t.state.paused||(t.progress=t.state.position+(Date.now()-t.state.timestamp)))}),200),window.onSpotifyWebPlaybackSDKReady=function(){t.player=new window.Spotify.Player({name:"Syncify Player",getOAuthToken:function(t){t(e)}}),t.player.addListener("initialization_error",(function(){t.error="Spotify SDK failed to load. Make sure you are using the desktop versions of Mozilla Firefox or Google Chrome."})),t.player.addListener("ready",(function(t){var e=t.device_id,o={device_ids:[e]};g.put("https://api.spotify.com/v1/me/player",o,s).catch((function(t){return console.error(t.response)}))})),t.player.addListener("player_state_changed",(function(e){if(null!=e){e.position%1!==0&&(e.position*=1e3),null==t.state&&(t.state=e);var s=e.track_window.current_track.uri;s!==t.track.uri&&t.socket.emit("song",s),t.state=e}})),t.player.connect()}},mounted:function(){var t=document.createElement("script");t.setAttribute("src","https://sdk.scdn.co/spotify-player.js"),t.async=!0,document.head.appendChild(t)},destroyed:function(){this.socket.close(),this.player.disconnect()}},_=w,x=Object(f["a"])(_,y,b,!1,null,null,null),C=x.exports,P={name:"App",components:{RoomMenu:v,Player:C},beforeCreate:function(){var t=this.$route.fullPath;if("/"!==t){for(var e=t.substring(2).split(/=|&/),s={},o=0;o<e.length-1;o+=2)s[e[o]]=e[o+1];this.$store.commit("setAccessToken",s.access_token),this.$router.replace({name:"App"})}else if(""===this.$store.state.accessToken){var r="https://nnsun.github.io/syncify",n={client_id:"e591edad43ce4db596dd8c73b73ba2a3",response_type:"token",redirect_uri:r,scope:"user-read-playback-state streaming user-read-email user-read-private user-modify-playback-state"};window.open("https://accounts.spotify.com/authorize?"+new URLSearchParams(n).toString(),"_self")}}},S=P,T=(s("034f"),Object(f["a"])(S,i,c,!1,null,null,null)),j=T.exports;s("a347");o["a"].config.productionTip=!1,o["a"].use(r["a"]);var $=new r["a"]({mode:"history",routes:[{name:"App",path:"/",component:j}],base:"/syncify/"});new o["a"]({render:function(t){return t(j)},router:$,store:a}).$mount("#app")},"85ec":function(t,e,s){},a347:function(t,e,s){}});
//# sourceMappingURL=app.f1cf7d26.js.map